{"version":3,"file":"LosslessNumber.js","names":["compareNumber","countSignificantDigits","getUnsafeNumberReason","isInteger","isNumber","UnsafeNumberReason","LosslessNumber","isLosslessNumber","constructor","value","Error","valueOf","unsafeReason","undefined","truncate_float","Number","parseFloat","BigInt","toString","toLosslessNumber","maxDigits","String","isNaN","isFinite","compareLosslessNumber","a","b"],"sources":["../../src/LosslessNumber.ts"],"sourcesContent":["import {\n  compareNumber,\n  countSignificantDigits,\n  getUnsafeNumberReason,\n  isInteger,\n  isNumber,\n  UnsafeNumberReason\n} from './utils.js'\n\n/**\n * A lossless number. Stores its numeric value as string\n */\nexport class LosslessNumber {\n  // numeric value as string\n  value: string\n\n  // type information\n  isLosslessNumber = true\n\n  constructor(value: string) {\n    if (!isNumber(value)) {\n      throw new Error(`Invalid number (value: \"${value}\")`)\n    }\n\n    this.value = value\n  }\n\n  /**\n   * Get the value of the LosslessNumber as number or bigint.\n   *\n   * - a number is returned for safe numbers and decimal values that only lose some insignificant digits\n   * - a bigint is returned for big integer numbers\n   * - an Error is thrown for values that will overflow or underflow\n   *\n   * Note that you can implement your own strategy for conversion by just getting the value as string\n   * via .toString(), and using util functions like isInteger, isSafeNumber, getUnsafeNumberReason,\n   * and toSafeNumberOrThrow to convert it to a numeric value.\n   */\n  valueOf(): number | bigint {\n    const unsafeReason = getUnsafeNumberReason(this.value)\n\n    // safe or truncate_float\n    if (unsafeReason === undefined || unsafeReason === UnsafeNumberReason.truncate_float) {\n      return Number.parseFloat(this.value)\n    }\n\n    // truncate_integer\n    if (isInteger(this.value)) {\n      return BigInt(this.value)\n    }\n\n    // overflow or underflow\n    throw new Error(\n      `Cannot safely convert to number: the value '${this.value}' would ${unsafeReason} and become ${Number.parseFloat(this.value)}`\n    )\n  }\n\n  /**\n   * Get the value of the LosslessNumber as string.\n   */\n  toString(): string {\n    return this.value\n  }\n\n  // Note: we do NOT implement a .toJSON() method, and you should not implement\n  // or use that, it cannot safely turn the numeric value in the string into\n  // stringified JSON since it has to be parsed into a number first.\n}\n\n/**\n * Test whether a value is a LosslessNumber\n */\nexport function isLosslessNumber(value: unknown): value is LosslessNumber {\n  // @ts-expect-error\n  return (value && typeof value === 'object' && value.isLosslessNumber) || false\n}\n\n/**\n * Convert a number into a LosslessNumber if this is possible in a safe way\n * If the value has too many digits, or is NaN or Infinity, an error will be thrown\n */\nexport function toLosslessNumber(value: number): LosslessNumber {\n  const maxDigits = 15\n  if (countSignificantDigits(String(value)) > maxDigits) {\n    throw new Error(\n      `Invalid number: contains more than 15 digits and is most likely truncated and unsafe by itself (value: ${value})`\n    )\n  }\n\n  if (Number.isNaN(value)) {\n    throw new Error('Invalid number: NaN')\n  }\n\n  if (!Number.isFinite(value)) {\n    throw new Error(`Invalid number: ${value}`)\n  }\n\n  return new LosslessNumber(String(value))\n}\n\n/**\n * Compare two lossless numbers.\n * Returns 1 when a is larger than b, 0 when they are equal,\n * and -1 when a is smaller than b.\n */\nexport function compareLosslessNumber(a: LosslessNumber, b: LosslessNumber): 1 | 0 | -1 {\n  return compareNumber(a.value, b.value)\n}\n"],"mappings":"AAAA,SACEA,aAAa,EACbC,sBAAsB,EACtBC,qBAAqB,EACrBC,SAAS,EACTC,QAAQ,EACRC,kBAAkB,QACb,YAAY;;AAEnB;AACA;AACA;AACA,OAAO,MAAMC,cAAc,CAAC;EAC1B;;EAGA;EACAC,gBAAgB,GAAG,IAAI;EAEvBC,WAAWA,CAACC,KAAa,EAAE;IACzB,IAAI,CAACL,QAAQ,CAACK,KAAK,CAAC,EAAE;MACpB,MAAM,IAAIC,KAAK,CAAC,2BAA2BD,KAAK,IAAI,CAAC;IACvD;IAEA,IAAI,CAACA,KAAK,GAAGA,KAAK;EACpB;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEE,OAAOA,CAAA,EAAoB;IACzB,MAAMC,YAAY,GAAGV,qBAAqB,CAAC,IAAI,CAACO,KAAK,CAAC;;IAEtD;IACA,IAAIG,YAAY,KAAKC,SAAS,IAAID,YAAY,KAAKP,kBAAkB,CAACS,cAAc,EAAE;MACpF,OAAOC,MAAM,CAACC,UAAU,CAAC,IAAI,CAACP,KAAK,CAAC;IACtC;;IAEA;IACA,IAAIN,SAAS,CAAC,IAAI,CAACM,KAAK,CAAC,EAAE;MACzB,OAAOQ,MAAM,CAAC,IAAI,CAACR,KAAK,CAAC;IAC3B;;IAEA;IACA,MAAM,IAAIC,KAAK,CACb,+CAA+C,IAAI,CAACD,KAAK,WAAWG,YAAY,eAAeG,MAAM,CAACC,UAAU,CAAC,IAAI,CAACP,KAAK,CAAC,EAC9H,CAAC;EACH;;EAEA;AACF;AACA;EACES,QAAQA,CAAA,EAAW;IACjB,OAAO,IAAI,CAACT,KAAK;EACnB;;EAEA;EACA;EACA;AACF;;AAEA;AACA;AACA;AACA,OAAO,SAASF,gBAAgBA,CAACE,KAAc,EAA2B;EACxE;EACA,OAAQA,KAAK,IAAI,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,CAACF,gBAAgB,IAAK,KAAK;AAChF;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASY,gBAAgBA,CAACV,KAAa,EAAkB;EAC9D,MAAMW,SAAS,GAAG,EAAE;EACpB,IAAInB,sBAAsB,CAACoB,MAAM,CAACZ,KAAK,CAAC,CAAC,GAAGW,SAAS,EAAE;IACrD,MAAM,IAAIV,KAAK,CACb,0GAA0GD,KAAK,GACjH,CAAC;EACH;EAEA,IAAIM,MAAM,CAACO,KAAK,CAACb,KAAK,CAAC,EAAE;IACvB,MAAM,IAAIC,KAAK,CAAC,qBAAqB,CAAC;EACxC;EAEA,IAAI,CAACK,MAAM,CAACQ,QAAQ,CAACd,KAAK,CAAC,EAAE;IAC3B,MAAM,IAAIC,KAAK,CAAC,mBAAmBD,KAAK,EAAE,CAAC;EAC7C;EAEA,OAAO,IAAIH,cAAc,CAACe,MAAM,CAACZ,KAAK,CAAC,CAAC;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASe,qBAAqBA,CAACC,CAAiB,EAAEC,CAAiB,EAAc;EACtF,OAAO1B,aAAa,CAACyB,CAAC,CAAChB,KAAK,EAAEiB,CAAC,CAACjB,KAAK,CAAC;AACxC","ignoreList":[]}